# 📊 KPI Tracking - Complete Guide

## ✅ Fully Implemented & Accurate

The KPI system now includes both **auto-calculated KPIs** from real data and **manual KPI recording** for custom metrics.

---

## 🎯 Two Ways to Track KPIs

### 1. **Auto-Calculated KPIs** (Accurate & Real-Time) ⭐
Based on your actual activity:
- ✅ Task completion rate
- ✅ On-time delivery rate
- ✅ Average goal progress
- ✅ Hours worked
- ✅ Productivity score
- ✅ Review performance score

**Updated automatically from:**
- Tasks you complete
- Time tracking entries
- Goal progress
- Review ratings

### 2. **Manual KPI Recording** (Custom Metrics)
Record any metric you want to track:
- Sales numbers
- Customer satisfaction
- Code quality scores
- Custom business metrics
- Any measurement you track

---

## 📈 **Auto-Calculated KPIs** (NEW!)

### What They Are

**6 KPIs calculated automatically from real data:**

#### 1. **Task Completion Rate** 📋
- **Formula:** `(Completed Tasks / Total Tasks) × 100`
- **Data Source:** Tasks assigned to you
- **Example:** "15 of 20 tasks completed = 75%"
- **Category:** Productivity

#### 2. **On-Time Delivery Rate** ⏰
- **Formula:** `(On-Time Tasks / Completed Tasks) × 100`
- **Data Source:** Tasks with due dates
- **Example:** "12 of 15 tasks completed on time = 80%"
- **Category:** Quality

#### 3. **Average Goal Progress** 🎯
- **Formula:** `Average of all active goal progress`
- **Data Source:** Your approved, active goals
- **Example:** "3 goals at 60%, 80%, 90% = 76.7% average"
- **Category:** Goals

#### 4. **Hours Worked** 🕐
- **Formula:** `Sum of clock-out minus clock-in`
- **Data Source:** Time tracking entries
- **Example:** "160 hours worked this month"
- **Category:** Activity

#### 5. **Productivity Score** ⚡
- **Formula:** `(Tasks Completed / Hours Worked) × 20`
- **Data Source:** Tasks + time tracking
- **Example:** "15 tasks in 40 hours = 75% productivity"
- **Category:** Efficiency

#### 6. **Review Performance Score** ⭐
- **Formula:** `(Average Rating / 5) × 100`
- **Data Source:** Recent performance reviews
- **Example:** "4.5 average rating = 90% score"
- **Category:** Quality

---

## 🖱️ **How to Use Auto-Calculated KPIs**

### Step 1: Go to KPI Trends Tab

```
Performance → KPI Trends
```

### Step 2: View Auto-Calculated Section

You'll see a section at the top showing real-time KPIs:

```
┌─────────────────────────────────────────────────────┐
│ Auto-Calculated KPIs        [Last 30 days ▼] [🔄]  │
├─────────────────────────────────────────────────────┤
│                                                      │
│ 📊 Task Completion Rate          [Productivity]     │
│    85.5%                                   [Record] │
│    17 of 20 tasks completed in last 30 days         │
│                                                      │
│ ⏰ On-Time Delivery Rate         [Quality]          │
│    94.1%                                   [Record] │
│    16 of 17 tasks completed on time                 │
│                                                      │
│ 🎯 Average Goal Progress         [Goals]            │
│    76.7%                                   [Record] │
│    Average progress across 3 active goals           │
│                                                      │
│ 🕐 Hours Worked                  [Activity]         │
│    124.5 hours                             [Record] │
│    Total hours worked in last 30 days               │
│                                                      │
│ ⚡ Productivity Score            [Efficiency]       │
│    68.5%                                   [Record] │
│    17 tasks completed in 124.5 hours                │
│                                                      │
│ ⭐ Review Performance Score      [Quality]          │
│    90.0%                                   [Record] │
│    Average rating from recent reviews               │
│                                                      │
│ 💡 Tip: Recording KPIs regularly helps track your   │
│    performance trends over time.                     │
└─────────────────────────────────────────────────────┘
```

### Step 3: Record KPIs

Click **"Record"** on any KPI to save it as a snapshot. This creates a data point for trend tracking.

### Step 4: View Trends

Scroll down to **"Historical Trends"** section to see charts of recorded KPIs over time.

---

## ➕ **How to Record Custom KPIs**

### Step 1: Click "Record Custom KPI"

```
KPI Trends Tab → [+ Record Custom KPI] button
```

### Step 2: Choose Method

**Option A: Use Template (Easy)**
- Select from 10 pre-defined KPI templates
- Examples: Customer Satisfaction, Sales Target, Code Quality
- Unit pre-filled

**Option B: Custom KPI (Flexible)**
- Enter your own KPI name
- Define custom unit
- Track any metric you want

### Step 3: Enter Values

```
┌─────────────────────────────────────────────────┐
│ Record KPI Snapshot                              │
├─────────────────────────────────────────────────┤
│ [Use Template] [Custom KPI]                     │
│                                                  │
│ Select KPI Template:                             │
│ ┌──────────────────┬──────────────────┐        │
│ │ Task Completion  │ Customer Sat.    │        │
│ │ Productivity • % │ Quality • %      │        │
│ ├──────────────────┼──────────────────┤        │
│ │ Sales Target     │ Project Delivery │        │
│ │ Sales • %        │ Delivery • %     │        │
│ └──────────────────┴──────────────────┘        │
│                                                  │
│ KPI Name: Task Completion Rate                  │
│                                                  │
│ Value: [85.5]          Unit: [%]                │
│                                                  │
│ Notes (Optional):                                │
│ [Q3 2025 results                               ] │
│                                                  │
│ Preview:                                         │
│ ┌─────────────────────────────────────┐        │
│ │ 85.5%                                │        │
│ │ Task Completion Rate                 │        │
│ │ Q3 2025 results                      │        │
│ └─────────────────────────────────────┘        │
│                                                  │
│ [Cancel]                    [+ Record KPI]      │
└─────────────────────────────────────────────────┘
```

### Step 4: Save

Click **"Record KPI"** and it's saved instantly. The trend chart updates automatically.

---

## 📊 **KPI Templates Available**

### Productivity
- Task Completion Rate (%)
- Learning & Development Hours (hours)

### Quality
- Customer Satisfaction (%)
- Code Quality Score (/10)
- Review Performance Score (%)

### Sales
- Sales Target Achievement (%)
- Revenue Generated ($)

### Delivery
- Project Delivery Rate (%)
- On-Time Delivery Rate (%)

### Teamwork
- Team Collaboration Score (/5)

### Service
- Response Time (hours)

### Innovation
- Innovation Projects (#)

**Total:** 10+ templates to choose from!

---

## 🎯 **Accurate KPI Calculations**

### How It Works

**Real-Time Data Sources:**

```
Tasks Database
    ↓
Task Completion Rate = (Completed / Total) × 100

Time Tracking Database
    ↓
Hours Worked = Sum of (Clock Out - Clock In)

Goals Database
    ↓
Goal Progress = Average of Active Goals Progress

Reviews Database
    ↓
Review Score = (Average Rating / 5) × 100

Combined Data
    ↓
Productivity = Tasks Per Hour × 20
```

**Example Calculation:**

```
User Activity (Last 30 Days):
- 20 tasks assigned
- 17 tasks completed
- 16 completed on time
- 124.5 hours worked
- 3 active goals (60%, 80%, 90%)
- Average review rating: 4.5/5

Calculated KPIs:
✅ Task Completion: 85.0% (17/20)
✅ On-Time Rate: 94.1% (16/17)
✅ Goal Progress: 76.7% average
✅ Hours Worked: 124.5 hours
✅ Productivity: 68.5% (17 tasks / 124.5 hours)
✅ Review Score: 90.0% (4.5/5)
```

---

## 📈 **Trend Tracking**

### How Trends Are Calculated

**Direction Indicators:**

- **↑ Improving** - Latest value > first value by 5%+
- **↓ Declining** - Latest value < first value by 5%+
- **→ Stable** - Within 5% of first value

**Example:**

```
Customer Satisfaction Trend:
Jan: 88% → Feb: 90% → Mar: 92%

First value: 88%
Last value: 92%
Difference: +4.5% improvement
Trend: ↑ Improving
```

---

## 🔄 **Suggested Workflow**

### Weekly KPI Recording

**Every Week:**
1. Go to Performance → KPI Trends
2. Review auto-calculated KPIs
3. Click "Record" on key metrics
4. (Optional) Add custom KPIs
5. View trends to track progress

**Monthly:**
1. Record all 6 auto-calculated KPIs
2. Compare to previous month
3. Identify trends
4. Adjust goals if needed

**Quarterly:**
1. Review 90-day trends
2. Generate performance reports
3. Set new KPI targets

---

## 💡 **Best Practices**

### DO ✅
- Record KPIs consistently (weekly/monthly)
- Use auto-calculated KPIs for accuracy
- Track 3-6 key metrics (don't overdo it)
- Review trends regularly
- Add notes for context

### DON'T ❌
- Don't manually enter task completion (use auto-calc)
- Don't skip weeks (breaks trend analysis)
- Don't track too many KPIs (focus on key ones)
- Don't forget to clock in/out (affects calculations)

---

## 🧪 **Test the Features**

### Test Auto-Calculated KPIs

**Prerequisites:**
- Complete some tasks
- Clock in/out for time tracking
- Create and update goals
- Have some reviews (optional)

**Steps:**
1. Go to Performance → KPI Trends
2. See "Auto-Calculated KPIs" section
3. View 6 calculated metrics
4. Click "Record" on any KPI
5. Scroll to "Historical Trends"
6. See the KPI chart updated

**Expected Result:**
```
✅ Shows 6 auto-calculated KPIs
✅ Values are accurate based on real data
✅ Click Record → KPI saved
✅ Chart shows the new data point
✅ Trend indicator updates
```

### Test Custom KPI Recording

1. Performance → KPI Trends
2. Click "Record Custom KPI"
3. Select template OR create custom
4. Enter value
5. Click "Record KPI"
6. See it in trends chart

**Expected Result:**
```
✅ Modal opens
✅ Can choose template or custom
✅ Preview shows before saving
✅ KPI records successfully
✅ Appears in Historical Trends
```

---

## 📊 **Example Use Cases**

### Use Case 1: Software Developer

**Auto-Calculated:**
- Task Completion: 90%
- On-Time Rate: 95%
- Hours Worked: 160 hours
- Productivity: 75%

**Custom KPIs:**
- Code Quality Score: 9.2/10
- Bugs Fixed: 23 bugs
- Code Reviews: 15 reviews

### Use Case 2: Sales Representative

**Auto-Calculated:**
- Goal Progress: 85%
- Review Score: 92%

**Custom KPIs:**
- Sales Target Achievement: 120%
- Revenue Generated: $250,000
- Customer Satisfaction: 94%
- New Clients: 12 clients

### Use Case 3: Project Manager

**Auto-Calculated:**
- Task Completion: 100%
- On-Time Rate: 88%
- Goal Progress: 78%

**Custom KPIs:**
- Project Delivery Rate: 100%
- Team Collaboration: 4.5/5
- Budget Adherence: 95%

---

## 🚀 **Quick Actions**

### Record a KPI Right Now

**Option 1: Use Auto-Calculated (Easiest)**
```
1. Performance → KPI Trends
2. Find "Task Completion Rate"
3. Click "Record"
4. Done! ✅
```

**Option 2: Manual Entry**
```
1. Performance → KPI Trends
2. Click "Record Custom KPI"
3. Template: "Customer Satisfaction"
4. Value: 92.5
5. Unit: %
6. Click "Record KPI"
7. Done! ✅
```

---

## 📊 **KPI Dashboard Layout**

```
┌──────────────────────────────────────────────────┐
│ Performance > KPI Trends                          │
├──────────────────────────────────────────────────┤
│                                                   │
│ ┌────────────────────────────────────────────┐  │
│ │ AUTO-CALCULATED KPIs (Real-Time)           │  │
│ │                                             │  │
│ │ 📊 85.5% Task Completion    [Record]       │  │
│ │ ⏰ 94.1% On-Time Delivery   [Record]       │  │
│ │ 🎯 76.7% Goal Progress      [Record]       │  │
│ │ 🕐 124.5 hours worked       [Record]       │  │
│ │ ⚡ 68.5% Productivity       [Record]       │  │
│ │ ⭐ 90.0% Review Score       [Record]       │  │
│ └────────────────────────────────────────────┘  │
│                                                   │
│ ┌────────────────────────────────────────────┐  │
│ │ HISTORICAL TRENDS                           │  │
│ │                                             │  │
│ │ Task Completion Rate          ↑ Improving  │  │
│ │ 85.5%                                       │  │
│ │ [████████████████░░░░░░░░░░░]             │  │
│ │                                             │  │
│ │ Customer Satisfaction         → Stable     │  │
│ │ 92.0%                                       │  │
│ │ [██████████████████████░░░░░]             │  │
│ └────────────────────────────────────────────┘  │
│                                                   │
│               [+ Record Custom KPI]               │
└──────────────────────────────────────────────────┘
```

---

## 🎨 **Visual Features**

### Auto-Calculated KPI Cards

**Color-Coded by Category:**
- 🔵 Blue border = Productivity
- 🟢 Green border = Quality
- 🟣 Purple border = Goals
- 🟠 Orange border = Activity
- 🟦 Indigo border = Efficiency

**Each Card Shows:**
- Icon (category-specific)
- KPI name
- Large value with unit
- Description of calculation
- "Record" button

### Trend Charts

**Interactive Bar Charts:**
- Hover for exact values
- Tooltip shows date + value
- Up to 12 most recent data points
- Responsive width

**Trend Indicators:**
- ↑ Green badge = Improving
- ↓ Red badge = Declining
- → Gray badge = Stable

---

## 🔧 **API Reference**

### Get Auto-Calculated KPIs

```bash
GET /api/v1/performance/kpi-snapshots/auto-calculate/{user_id}?days=30

Response:
{
  "user_id": 1,
  "period_days": 30,
  "calculated_at": "2025-10-19T...",
  "kpis": [
    {
      "kpi_name": "Task Completion Rate",
      "value": 85.5,
      "unit": "%",
      "description": "17 of 20 tasks completed...",
      "category": "Productivity"
    },
    ...
  ],
  "recommendation": "You can record any of these KPIs..."
}
```

### Record KPI Snapshot

```bash
POST /api/v1/performance/kpi-snapshots

Body:
{
  "user_id": 1,
  "kpi_name": "Task Completion Rate",
  "value": 85.5,
  "unit": "%",
  "notes": "Q3 2025 results"
}
```

### Get KPI Trends

```bash
GET /api/v1/performance/kpi-snapshots/trends?user_id=1&days=90

Response:
[
  {
    "kpi_name": "Task Completion Rate",
    "unit": "%",
    "current_value": 85.5,
    "trend_direction": "up",
    "data_points": [
      {"date": "2025-07-15", "value": 78.0},
      {"date": "2025-08-15", "value": 82.5},
      {"date": "2025-09-15", "value": 85.5}
    ]
  }
]
```

---

## 📅 **Recommended Tracking Schedule**

### Weekly (Every Monday)
```
✅ Review auto-calculated KPIs
✅ Record "Task Completion Rate"
✅ Record "Productivity Score"
```

### Monthly (First of Month)
```
✅ Record all 6 auto-calculated KPIs
✅ Add custom KPIs (sales, satisfaction, etc.)
✅ Review 90-day trends
✅ Compare to previous month
```

### Quarterly
```
✅ Deep dive into trend analysis
✅ Identify improvement areas
✅ Set new KPI targets
✅ Report to manager
```

---

## 🎯 **KPI Targets & Goals**

### Link KPIs to Goals

**Example:**

**Goal:** "Improve Task Completion Rate"
**Target:** 95%
**Current:** 85.5%

**Track Progress:**
- Month 1: Record 85.5%
- Month 2: Record 88.0%
- Month 3: Record 92.0%
- Month 4: Record 95.0% ✅ Goal achieved!

---

## ✅ **Summary**

**Auto-Calculated KPIs:**
- ✅ **6 KPIs** calculated from real data
- ✅ **Accurate** - No manual entry errors
- ✅ **Real-Time** - Always up-to-date
- ✅ **One-Click Recording** - Easy to save
- ✅ **Period Selection** - 7, 30, 60, or 90 days

**Manual KPI Recording:**
- ✅ **Custom metrics** - Track anything
- ✅ **10+ templates** - Common KPIs ready
- ✅ **Full control** - Enter any value
- ✅ **Notes field** - Add context

**Trend Visualization:**
- ✅ **Bar charts** - Visual progress
- ✅ **Trend indicators** - Up/down/stable
- ✅ **Tooltips** - Detailed values
- ✅ **Multi-KPI support** - Track many metrics

**Integration:**
- ✅ Performance page → KPI Trends tab
- ✅ Auto-refresh after recording
- ✅ Respects settings (`performance_show_kpi_trends`)
- ✅ Permission-gated (self, manager, admin)

---

## 🎉 **What's Different Now**

**Before:**
- ❌ Manual KPI entry only
- ❌ No auto-calculation
- ❌ Basic placeholder KPIs

**After:**
- ✅ Auto-calculated from real data
- ✅ 6 accurate KPIs available
- ✅ One-click recording
- ✅ Custom KPIs + templates
- ✅ Beautiful visualizations

---

## 🚀 **Start Tracking Now**

```
1. Go to /performance
2. Click "KPI Trends" tab
3. See your auto-calculated KPIs
4. Click "Record" on any KPI
5. View Historical Trends chart
```

**Your accurate, data-driven KPI tracking system is ready!** 📊✨

---

**Components:**
- `AutoCalculatedKpis.tsx` - Real-time KPI calculation display
- `KpiRecordModal.tsx` - Manual KPI recording form
- `KpiTrendChart.tsx` - Historical trend visualization

**API Endpoints:**
- `GET /performance/kpi-snapshots/auto-calculate/{id}` - Calculate KPIs
- `POST /performance/kpi-snapshots` - Record KPI
- `GET /performance/kpi-snapshots/trends` - Get trends

**Status:** ✅ **COMPLETE & ACCURATE**

